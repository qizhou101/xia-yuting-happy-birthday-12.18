<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>Ëá¥ÔºöÂ§èÈõ®Â©∑</title>
<link href="https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=ZCOOL+XiaoWei&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
body,html{width:100%;height:100%;overflow:hidden;font-family:'ZCOOL XiaoWei',serif;text-align:center;background:#050714;color:#fff}

/* ËÉåÊôØ */
.ambient-light{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;background:radial-gradient(ellipse at bottom,#1b2735 0%,#090a0f 100%)}
.blob{position:absolute;border-radius:50%;filter:blur(80px);opacity:.4;animation:float 10s infinite ease-in-out alternate}
.b1{top:-10%;left:-10%;width:50vw;height:50vw;background:#2c3e50}
.b2{bottom:-10%;right:-10%;width:60vw;height:60vw;background:#000}
.b3{top:30%;left:40%;width:40vw;height:40vw;background:#1a1a2e;animation-delay:-5s}
@keyframes float{0%{transform:translate(0,0) scale(1)}100%{transform:translate(20px,-20px) scale(1.1)}}
canvas{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1}
.container{position:absolute;width:100%;height:100%;z-index:10;pointer-events:none}

/* È¶ñÈ°µ */
@keyframes bouncyPop{0%{opacity:0;transform:scale(.3) translateY(20px)}50%{opacity:.8;transform:scale(1.1) translateY(-10px)}70%{transform:scale(.95) translateY(5px)}100%{opacity:1;transform:scale(1) translateY(0)}}
.glass-box{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.3);box-shadow:0 20px 50px rgba(0,0,0,0.3),inset 0 0 20px rgba(255,255,255,.05);padding:40px 30px;border-radius:20px;width:85%;max-width:420px;display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:100;backdrop-filter:blur(10px);pointer-events:auto}
.glass-box h2,.glass-box p,.glass-box .input-wrapper,.glass-box .btn{opacity:0;animation:bouncyPop .8s cubic-bezier(.68,-.55,.265,1.55) forwards}
.glass-box h2{animation-delay:.1s;margin:0 0 25px;letter-spacing:6px;font-size:38px;font-weight:bold;text-shadow:0 2px 10px rgba(0,0,0,.5)}
.glass-box p{animation-delay:.2s;margin-bottom:25px;font-size:18px;color:rgba(255,255,255,.9)}
.input-wrapper{animation-delay:.3s;width:100%;margin-bottom:25px}
.glass-box .btn{animation-delay:.4s}
input{width:100%;background:rgba(255,255,255,.15);border:none;border-bottom:2px solid rgba(255,255,255,.5);color:#fff;font-size:28px;text-align:center;padding:12px;outline:0;border-radius:8px;transition:.3s}
input:focus{background:rgba(255,255,255,.25);border-color:#ffd700}
.btn{padding:15px 60px;border-radius:50px;border:1px solid rgba(255,255,255,.4);background:rgba(255,255,255,.2);color:#fff;cursor:pointer;font-size:20px;letter-spacing:4px;box-shadow:0 4px 15px rgba(0,0,0,.2);transition:all .2s}
.btn:hover{background:rgba(255,255,255,.35);transform:scale(1.05)}

/* ÂÄíËÆ°Êó∂ */
.countdown{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(.5);font-size:25vw;font-weight:bold;color:transparent;-webkit-text-stroke:3px rgba(165,220,255,.9);background:linear-gradient(180deg,#fff 20%,rgba(165,220,255,.2) 80%);-webkit-background-clip:text;opacity:0;transition:all .3s}
.countdown.show{opacity:1;transform:translate(-50%,-50%) scale(1)}
.countdown.beat{transform:translate(-50%,-50%) scale(1.2)}

/* ËõãÁ≥ïËàûÂè∞ */
.cake-stage{position:absolute;top:45%;left:50%;transform:translate(-50%,-50%) scale(1.25);opacity:0;display:none;transition:opacity 1.2s;width:100%;flex-direction:column;align-items:center;justify-content:center;z-index:50}
.cake-stage.show{opacity:1;display:flex}
.cake-stage h1{color:#fff;margin-bottom:130px;font-weight:900;letter-spacing:6px;font-size:60px;text-shadow:0 0 30px rgba(255,255,255,.6);white-space:nowrap}
.dynamic-title span{display:inline-block;animation:wave 1.5s infinite ease-in-out}
@keyframes wave{0%,100%{transform:translateY(0)}50%{transform:translateY(-15px)}}
.dynamic-title span:nth-child(1){animation-delay:0s}.dynamic-title span:nth-child(2){animation-delay:.1s}.dynamic-title span:nth-child(3){animation-delay:.2s}.dynamic-title span:nth-child(4){animation-delay:.3s}.dynamic-title span:nth-child(5){animation-delay:.4s}.dynamic-title span:nth-child(6){animation-delay:.5s}.dynamic-title span:nth-child(7){animation-delay:.6s}
.cake-text{width:100%;text-align:center;color:rgba(255,255,255,.9);font-size:18px;margin-top:60px;letter-spacing:2px;opacity:0;transition:opacity 1s}
.cake-text.show{opacity:1}

/* 3DËõãÁ≥ï */
.cake-3d{position:relative;width:320px;height:380px;margin:0 auto;transform-style:preserve-3d;perspective:2000px}
.tier{position:absolute;left:50%;transform:translateX(-50%)}
.tier-body{width:100%;height:100%;background:linear-gradient(to right,#dcdcdc 0%,#fff 30%,#fff 70%,#dcdcdc 100%);border-radius:5px;position:relative;z-index:10}
.tier-top{position:absolute;top:0;left:0;width:100%;height:40px;background:#fff;border-radius:50%;transform:translateY(-50%);z-index:11;box-shadow:inset 0 0 10px rgba(0,0,0,.05);display:flex;justify-content:center;align-items:center}
.l1{bottom:0;width:320px;height:90px;z-index:1}.l1 .tier-top{height:70px}
.l2{bottom:90px;width:270px;height:80px;z-index:2}.l2 .tier-top{height:60px}
.l3{bottom:170px;width:220px;height:70px;z-index:3}.l3 .tier-top{height:50px}
.l4{bottom:240px;width:170px;height:60px;z-index:4}.l4 .tier-top{height:40px}
.l5{bottom:300px;width:120px;height:60px;z-index:5}.l5 .tier-top{height:30px}
.fruit{position:absolute;filter:drop-shadow(1px 2px 2px rgba(0,0,0,.3))}
.f-swb{width:18px;height:20px;background:radial-gradient(circle at 30% 30%,#ff5e57,#d63031);border-radius:50% 50% 50% 10%;transform:rotate(45deg)}
.f-swb::after{content:'';position:absolute;width:100%;height:100%;background-image:radial-gradient(circle,rgba(0,0,0,.2) 1px,transparent 2px);background-size:3px 3px}
.f-mgo{width:14px;height:14px;background:linear-gradient(45deg,#ffeaa7,#fdcb6e);border-radius:2px;transform:rotate(15deg)}
.f-blb{width:10px;height:10px;background:radial-gradient(circle at 30% 30%,#70a1ff,#3742fa);border-radius:50%}
.f-gold{width:4px;height:4px;background:#ffd700;border-radius:50%;box-shadow:0 0 5px #ffd700;animation:sparkle 1.5s infinite}

/* Ëú°ÁÉõ */
.candle-3d{position:absolute;width:12px;height:60px;z-index:20;transform:translateX(-50%)}
.candle-body{position:relative;width:100%;height:100%;background:linear-gradient(to right,#ddd 0%,#fff 40%,#ddd 100%);border-radius:3px}
.candle-body::after { content: ''; position: absolute; top: -6px; left: 50%; transform: translateX(-50%); width: 2px; height: 6px; background: #222; z-index: 5; }
.flame{position:absolute;top:-20px;left:50%;transform:translateX(-50%);width:12px;height:20px;background:radial-gradient(ellipse at bottom,#ffff00 0%,#ff5e00 80%);border-radius:50% 50% 35% 35%;box-shadow:0 0 10px #ffff00,0 0 20px #ff5e00;animation:flicker .9s infinite alternate;transform-origin:bottom center;transition:all .3s ease-in;z-index:10}
.flame.out{animation:none !important; transform:translateX(-50%) scale(0) !important; opacity:0 !important}
@keyframes flicker{0%{transform:translateX(-50%) scale(1) rotate(-2deg);opacity:1}100%{transform:translateX(-50%) scale(1.1) rotate(2deg);opacity:.9}}
.pos-l1{bottom:85px;z-index:20}.pos-l2{bottom:165px;z-index:20}.pos-l3{bottom:235px;z-index:20}.pos-l4{bottom:295px;z-index:20}.pos-l5{bottom:350px;z-index:20;height:60px}

/* === ÁªìÂ∞æÂ∏ÉÂ±ÄÊ†∏ÂøÉ (ÁªùÂØπÂàÜÂ±Ç) === */
#final-stage-container{position:absolute;top:0;left:0;width:100%;height:100%;display:none;pointer-events:none;z-index:50}
#final-stage-container.show{display:block}
#danmaku-container{position:absolute;top:0;left:0;width:100%;height:100%;z-index:20;overflow:hidden;pointer-events:none}

/* Âå∫Âüü3ÔºöÁÖßÁâáÂ¢ô */
#photo-wall{
    position:absolute;
    bottom:0; left:0; width:100%; 
    height:45%; 
    padding:10px;
    box-sizing:border-box;
    display:flex; justify-content:center; align-items:center;
    z-index:30;
}

.photo-grid{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    grid-template-rows:repeat(2,1fr);
    gap:10px;
    width:100%; max-width:900px;
    height: 100%;
}

.photo-frame{position:relative;width:100%;height:100%;background:#fff;padding:4px;border:3px solid #c5a000;box-shadow:0 5px 15px rgba(0,0,0,.8);border-radius:4px;overflow:hidden;transform:scale(0);opacity:0}
.photo-frame img{width:100%;height:100%;object-fit:cover;display:block}
.photo-frame.show{animation:photoEntrance 1.5s cubic-bezier(.19,1,.22,1) forwards}
@keyframes photoEntrance{0%{opacity:0;transform:scale(0);z-index:10}50%{opacity:1;transform:scale(1.1);z-index:100}100%{opacity:1;transform:scale(1);z-index:1}}

/* Âå∫Âüü2ÔºöÊñáÂ≠ó */
.final-text-block{
    position:absolute;
    top: 40%;
    left:50%; transform:translate(-50%,-50%);
    text-align:center; z-index:99999;
    opacity:0; width:95%;
    text-shadow:0 0 20px rgba(0,0,0,.9),3px 3px 0 #000;
}
.final-text-block.show{animation:textPop 1.2s cubic-bezier(.34,1.56,.64,1) forwards}
@keyframes textPop{0%{opacity:0;transform:translate(-50%,-50%) scale(.5)}100%{opacity:1;transform:translate(-50%,-50%) scale(1)}}
.main-title{font-size:48px;color:#ffd700;margin-bottom:15px;font-weight:900;letter-spacing:2px;line-height:1.2}
.sub-title{font-size:24px;color:#fff;letter-spacing:2px;font-weight:bold}

/* Âå∫Âüü1ÔºöÂºπÂπï */
.bubble{position:absolute;padding:6px 12px;background:hsl(var(--h),70%,95%,.9);border-radius:20px;font-size:13px;color:#333;box-shadow:0 2px 5px rgba(0,0,0,.2);opacity:0;white-space:nowrap;font-weight:bold;pointer-events:none}
.bubble.left-in{animation:flyRight 2s cubic-bezier(.34,1.56,.64,1) forwards}
.bubble.right-in{animation:flyLeft 2s cubic-bezier(.34,1.56,.64,1) forwards}
@keyframes flyRight{0%{opacity:0;transform:translateX(-30px) scale(.5)}20%{opacity:1}100%{opacity:1;transform:translateX(10px) scale(1)}}
@keyframes flyLeft{0%{opacity:0;transform:translateX(30px) scale(.5)}20%{opacity:1}100%{opacity:1;transform:translateX(-10px) scale(1)}}

/* === ÁßªÂä®Á´ØÁâπÂà´ÈÄÇÈÖç === */
@media (max-width:768px){
    .cake-stage{transform:translate(-50%,-50%) scale(0.6); width:100%}
    .cake-stage h1{font-size:42px; margin-bottom:90px}
    .cake-text{margin-top:50px}
    .glass-box{width:90%; padding:30px 20px;}
    .final-text-block{ top: 42%; }
    .main-title{font-size:36px}
    .sub-title{font-size:18px}
    #photo-wall{ height:40%; bottom: 20px; padding: 0 10px; }
    .photo-grid{ gap: 5px; } 
    .photo-frame{ border-width: 2px; padding: 2px; }
}
</style>
</head>
<body>
    <audio id="bgmRain" src="Èõ®ÁöÑÂ£∞Èü≥.mp3" preload="auto" loop></audio>
    <audio id="bgmBirthday" src="ÁîüÊó•Âø´‰πê.mp3" preload="auto"></audio>
    <audio id="bgmFlower" src="‰∏ÄË∑ØÁîüËä±.mp3" preload="auto" loop></audio>

    <div class="ambient-light"><div class="blob b1"></div><div class="blob b2"></div><div class="blob b3"></div></div>
    
    <canvas id="skyCanvas"></canvas>
    <canvas id="fwCanvas"></canvas>

    <div id="main-container" class="container">
        <div id="stage1" class="glass-box interactive">
            <h2>Ëá¥ÔºöÂ§èÈõ®Â©∑</h2>
            <p>ËØ∑ËæìÂÖ•ÂºÄÂêØÂè£‰ª§ (1218)</p>
            <div class="input-wrapper"><input type="password" id="password" maxlength="4"></div>
            <button class="btn" onclick="verify()">ÂºÄÂêØÊÉäÂñú</button>
        </div>
        
        <div id="countdown" class="countdown">3</div>

        <div id="stage3" class="cake-stage">
            <h1 class="dynamic-title"><span>Â∞è</span><span>Â§è</span>Ôºå<span>Áîü</span><span>Êó•</span><span>Âø´</span><span>‰πê</span></h1>
            <div class="cake-3d">
                <div class="tier l1"><div class="tier-body"></div><div class="tier-top"><div class="fruit f-swb" style="left:10%;top:30%"></div><div class="fruit f-mgo" style="left:20%;top:60%"></div><div class="fruit f-blb" style="left:30%;top:75%"></div><div class="fruit f-swb" style="left:50%;top:80%"></div><div class="fruit f-mgo" style="left:70%;top:70%"></div><div class="fruit f-blb" style="left:85%;top:50%"></div><div class="fruit f-swb" style="left:90%;top:30%"></div><div class="fruit f-gold" style="left:40%;top:85%"></div><div class="fruit f-gold" style="left:60%;top:85%"></div></div></div>
                <div class="tier l2"><div class="tier-body"></div><div class="tier-top"><div class="fruit f-blb" style="left:15%;top:40%"></div><div class="fruit f-swb" style="left:30%;top:70%"></div><div class="fruit f-mgo" style="left:50%;top:80%"></div><div class="fruit f-swb" style="left:70%;top:70%"></div><div class="fruit f-blb" style="left:85%;top:40%"></div></div></div>
                <div class="tier l3"><div class="tier-body"></div><div class="tier-top"><div class="fruit f-mgo" style="left:20%;top:50%"></div><div class="fruit f-swb" style="left:40%;top:75%"></div><div class="fruit f-swb" style="left:60%;top:75%"></div><div class="fruit f-mgo" style="left:80%;top:50%"></div></div></div>
                <div class="tier l4"><div class="tier-body"></div><div class="tier-top"><div class="fruit f-gold" style="left:30%;top:70%"></div><div class="fruit f-swb" style="left:50%;top:80%"></div><div class="fruit f-gold" style="left:70%;top:70%"></div></div></div>
                <div class="tier l5"><div class="tier-body"></div><div class="tier-top"><div class="fruit f-swb" style="left:15%;top:40%"></div><div class="fruit f-mgo" style="left:30%;top:50%"></div><div class="fruit f-blb" style="left:50%;top:60%"></div><div class="fruit f-swb" style="left:85%;top:40%"></div><div class="fruit f-gold" style="left:70%;top:50%"></div></div></div>
                <div class="candle-3d pos-l5" style="left:38%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l5" style="left:62%"><div class="candle-body"></div><div class="flame"></div></div>
                <div class="candle-3d pos-l4" style="left:25%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l4" style="left:75%"><div class="candle-body"></div><div class="flame"></div></div>
                <div class="candle-3d pos-l3" style="left:20%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l3" style="left:80%"><div class="candle-body"></div><div class="flame"></div></div>
                <div class="candle-3d pos-l2" style="left:15%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l2" style="left:35%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l2" style="left:65%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l2" style="left:85%"><div class="candle-body"></div><div class="flame"></div></div>
                <div class="candle-3d pos-l1" style="left:10%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l1" style="left:30%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l1" style="left:70%"><div class="candle-body"></div><div class="flame"></div></div><div class="candle-3d pos-l1" style="left:90%"><div class="candle-body"></div><div class="flame"></div></div>
            </div>
            <p class="cake-text show" id="cakeHint">Èó≠‰∏äÁúºÔºåËÆ∏‰∏™ÊÑø... (7ÁßíÂêéÂêπÁÅ≠)</p>
        </div>
        
        <div id="final-stage-container">
            <div id="danmaku-container"></div>
            <div id="photo-wall">
                <div class="photo-grid">
                    <div class="photo-frame"><img src="Á¨¨‰∏ÄÊ¨°.jpg" alt="1"></div>
                    <div class="photo-frame"><img src="Á¨¨‰∫åÊ¨°.jpg" alt="2"></div>
                    <div class="photo-frame"><img src="Á¨¨‰∏âÊ¨°.jpg" alt="3"></div>
                    <div class="photo-frame"><img src="Á¨¨ÂõõÊ¨°.jpg" alt="4"></div>
                    <div class="photo-frame"><img src="Á¨¨‰∫îÊ¨°.jpg" alt="5"></div>
                    <div class="photo-frame"><img src="Á¨¨ÂÖ≠Ê¨°.jpg" alt="6"></div>
                    <div class="photo-frame"><img src="Á¨¨‰∏ÉÊ¨°.jpg" alt="7"></div>
                    <div class="photo-frame"><img src="Á¨¨ÂÖ´Ê¨°.jpg" alt="8"></div>
                </div>
            </div>
        </div>
        <div id="finalText" class="final-text-block">
            <div class="main-title">‚ú® Â∞èÂ§èÔºåÁîüÊó•Âø´‰πê ‚ú®</div>
            <div class="sub-title">‰∏ÄÁ†î‰∏∫ÂÆöÔºåÈ°∂Â≥∞Áõ∏ËßÅÔºÅ</div>
        </div>
    </div>

    <script>
        function get(id){return document.getElementById(id);}
        let animationMode='rain'; 
        const bgmRain=get('bgmRain');
        const bgmBirthday=get('bgmBirthday');
        const bgmFlower=get('bgmFlower');

        function safePlay(audio) { if(audio) { audio.play().catch(e => console.log("Play failed:", e)); } }
        function safePause(audio) { if(audio) { audio.pause(); } }

        // Ê†∏ÂøÉ‰øÆÂ§çÔºöÂ§öÈáç‰∫ã‰ª∂ÁõëÂê¨ÔºåÁ°Æ‰øùËß¶Êë∏ÂøÖÊúâÂ£∞
        function enableSound() {
            if (bgmRain.paused && get('stage1').style.display !== 'none') { safePlay(bgmRain); }
        }
        document.body.addEventListener('click', enableSound);
        document.body.addEventListener('touchstart', enableSound); // ÊâãÊú∫Á´ØÂÖ≥ÈîÆ
        document.getElementById('password').addEventListener('focus', enableSound); // ËæìÂÖ•Ê°ÜÂÖ≥ÈîÆ

        function verify(){ 
            if(get('password').value==='1218'){ 
                get('stage1').style.opacity=0; 
                safePause(bgmRain);
                bgmBirthday.muted=true; safePlay(bgmBirthday);
                safePlay(bgmFlower); setTimeout(() => safePause(bgmFlower), 50);
                setTimeout(()=>{ get('stage1').style.display='none'; startCountdown(); },800); 
            } else { alert('Âè£‰ª§ÈîôËØØ (ÁîüÊó•:1218)'); get('password').value=''; } 
        }

        function startCountdown(){ 
            const el=get('countdown'); let num=3; el.classList.add('show'); el.innerText=num; setTimeout(()=>el.classList.remove('beat'),200); 
            const t=setInterval(()=>{ num--; if(num>0){ el.innerText=num; el.classList.add('beat'); setTimeout(()=>el.classList.remove('beat'),200); } else { clearInterval(t); el.classList.remove('show'); setTimeout(showCake,800); } },1000); 
        }
        
        function showCake(){ 
            bgmBirthday.currentTime=0; bgmBirthday.muted=false; safePlay(bgmBirthday);
            get('stage3').classList.add('show'); 
            setTimeout(()=>{ 
                get('cakeHint').innerText='Âëº~ (ÊÑøÊúõÂ∑≤ËÆ∏‰∏ã)'; 
                document.querySelectorAll('.flame').forEach(f=>f.classList.add('out')); 
                setTimeout(()=>{ 
                    animationMode='meteor'; initMeteors();
                    launchConfettiRain();
                    setTimeout(()=>{
                        get('stage3').style.opacity=0; 
                        setTimeout(()=>{ 
                            safePause(bgmBirthday);
                            try { bgmFlower.currentTime=0; } catch(e){}
                            safePlay(bgmFlower);
                            get('stage3').style.display='none'; 
                            showFinalStage(); 
                        }, 1000);
                    }, 5000);
                }, 1000); 
            }, 7000); 
        }

        function launchConfettiRain(){
            const end = Date.now() + 15000; 
            const colors = ['#e0c3fc','#ffecd2','#8ec5fc','#c2e9fb','#ffd700','#ff9a9e','#fecfef'];
            (function frame(){
                if(Date.now() > end) return;
                confetti({particleCount:5,angle:270,spread:180,startVelocity:30,origin:{x:Math.random(),y:0},colors:colors,gravity:.8,scalar:.9,drift:Math.random()*2-1});
                requestAnimationFrame(frame);
            })();
        }

        const wishes = ["ÁîüÊó•Âø´‰πêÔºÅüç∞", "Â§áËÄÉËæõËã¶Âï¶ÔºåÂ∞èÂ§èÔºÅÂä†Ê≤πÔºÅ", "ËÆ∞ÂæóÊåâÊó∂ÂêÉÈ•≠ü•£ÔºåË∫´‰ΩìÁ¨¨‰∏Ä", "Â§©ÂÜ∑‰∫ÜË¶ÅÂ§öÁ©øÁÇπË°£Êúçüß£", "‰∏ÄÁ†î‰∏∫ÂÆöÔºåÈ°∂Â≥∞Áõ∏ËßÅÔºÅ‚õ∞Ô∏è", "Á¥Ø‰∫ÜÂ∞±Ê≠áÊ≠áÔºåÊàë‰ª¨‰∏ÄÁõ¥Âú®‚ù§Ô∏è", "1218ÔºåÂÖ®‰∏ñÁïå‰∏∫‰Ω†ËÆ©Ë∑Øüåü", "Âà´Â§™Â§ßÂéãÂäõÔºåÂ∞ΩÂäõÂ∞±Â•Ωüí™", "‰ªäÂ§©ÁöÑ‰Ω†ÊòØÊúÄÈó™‰∫ÆÁöÑ‚ú®", "ÊÑøÊ¢¶ÊÉ≥Â¶ÇÊòüËæ∞Ëà¨ÁíÄÁí®üåå", "ÂÜçÂùöÊåÅ‰∏Ä‰∏ãÔºåÂ§©Âø´‰∫Æ‰∫Ü‚òÄÔ∏è", "ÊûØÁá•ÁöÑÂ§ç‰π†‰πüË¶ÅËÆ∞ÂæóÁ¨ëüòä", "‰Ω†Â∑≤ÁªèÊòØËµ¢ÂÆ∂‰∫ÜüèÜ", "ÁÖßÈ°æÂ•ΩËá™Â∑±üçéÔºåÂà´ÊÑüÂÜí‰∫Ü", "ÂÅöËá™Â∑±ÁöÑÂÖâüïØÔ∏è", "ÊòüÂÖâ‰∏çË¥üËµ∂Ë∑Ø‰∫∫‚è≥", "Á•ùÔºöÂ≤ÅÂ≤ÅÂπ≥ÂÆâÔºå‰∏á‰∫ãËÉúÊÑèüßß", "ËÄÉÁ†î‰∏äÂ≤∏ÔºåÂâçÁ®ã‰ººÈî¶ÔºÅüéì", "ËõãÁ≥ïÂ±û‰∫éÂä™ÂäõÁöÑ‰Ω†üéÇ", "Â•ΩËøêËóèÂú®ÂùöÊåÅÈáåüçÄ", "‰Ω†ÊòØÊúÄÊ£íÁöÑÔºÅÁõ∏‰ø°Ëá™Â∑±üëç", "Êú™Êù•ÂèØÊúüüåà", "ÊòüÊòüÈÉΩÂú®Áúã‰Ω†Âä™ÂäõüëÄ", "Á†îÁ©∂ÁîüÊúãÂèãÔºåÁîüÊó•Âø´‰πêüéì", "Â§öÂñùÁÉ≠Ê∞¥ÔºåÊó©ÁÇπ‰ºëÊÅØüõèÔ∏è", "ÁÑ¶ËôëÈÄÄÊï£ÔºåÂ•ΩËøêÂä†Êª°ÔºÅ‚ú®", "‰πæÂù§Êú™ÂÆöÔºå‰Ω†ÊàëÁöÜÈªëÈ©¨üêé", "ÊâÄÊúâÁöÑÂä™ÂäõÈÉΩ‰ºöÁÆóÊï∞", "ÊÑø‰Ω†ÂêàÁ¨îÊó∂ÊúâÊàòÂ£´Êî∂ÂàÄÁöÑÈ™ÑÂÇ≤‚öîÔ∏è", "‰ªäÂ§©Âè™ËÆ∏Âø´‰πêÔºÅüéâ", "ÊåâÊó∂Áù°ËßâÔºå‰∏çË¶ÅÁÜ¨Â§úÂ§™Êôöüåõ", "‰Ω†ÁöÑÂùöÊåÅÁªàÂ∞ÜÁæéÂ•Ωüåü", "ÊÑøÊúõ‰∏ÄÂÆö‰ºöÂÆûÁé∞ÔºÅüôè", "‰øùÊåÅÁÉ≠Áà±ÔºåÂ•îËµ¥Â±±Êµ∑üåä", "Âú®ÂÜ¨Â§©ÁßØËìÑÂäõÈáèÔºåÂú®Êò•Â§©ÁªΩÊîæüå∏", "ËÄÉÁ•ûÈôÑ‰ΩìÔºåËíôÁöÑÂÖ®ÂØπÔºÅüéØ", "ËÆ∞ÂæóÁªôËá™Â∑±‰∏Ä‰∏™Â§ßÂ§ßÁöÑÊã•Êä±ü§ó", "Êó†ËÆ∫ÁªìÊûúÂ¶Ç‰ΩïÔºåÈÉΩ‰∏∫‰Ω†È™ÑÂÇ≤üíó", "ÂêÉÂ•ΩÂñùÂ•ΩÔºåÈïøÁîü‰∏çËÄÅüçú", "Âπ≥ÂÆâÂñú‰πêÔºåÂæóÂÅøÊâÄÊÑøüéè", "ÊÑø‰Ω†ÁöÑ‰∏ñÁïåÊ∞∏ËøúÊ∏©ÊöñÂêëÈò≥‚òÄÔ∏è", "ÂÜ≤Âà∫Èò∂ÊÆµÔºåÁ®≥‰ΩèËÉΩËµ¢ÔºÅüê¢", "ËÆ∞ÂæóÊä¨Â§¥ÁúãÁúãÊòüÊòü‚ú®", "‰Ω†ÁöÑËÉåÂêéÊúâÂæàÂ§ö‰∫∫ÊîØÊåÅ‰Ω†üë®‚Äçüë©‚Äçüëß‚Äçüë¶", "‰ªäÂ§©‰∏çÊÉ≥Â≠¶‰π†Â∞±‰ºëÊÅØ‰∏ÄÂ§©ÔºÅüõå", "Á•ù‰Ω†Êã•Êúâ‰∏Ä‰∏™Ë∂ÖÁ∫ßÊ£íÁöÑÁîüÊó•ÔºÅüéÅ", "ÂâçË∑ØÊµ©Ëç°Ôºå‰∏á‰∫ãÂ∞ΩÂèØÊúüÂæÖüõ§Ô∏è", "ÊÑø‰Ω†ÁúºÈáåÊúâÂÖâÔºåÂøÉ‰∏≠ÊúâÁà±üí°", "ÊâÄÊúâÁöÑÁæéÂ•ΩÂ¶ÇÊúüËÄåËá≥üíå", "ËÄÉÁ†îÂä†Ê≤πÔºÅÁîüÊó•Âø´‰πêÔºÅÂèåÂÄçÁ•ùÁ¶èÔºÅüéä"];
        
        function showFinalStage() { 
            get('final-stage-container').classList.add('show');
            const danmakuContainer = get('danmaku-container');
            const frames = document.querySelectorAll('.photo-frame');
            
            wishes.forEach((text, i) => {
                const bubble = document.createElement('div'); bubble.className = 'bubble'; bubble.innerText = text;
                const hue = Math.floor(Math.random() * 360); bubble.style.setProperty('--h', hue);
                
                const top = Math.random() * 35; 
                const left = Math.random() * 90 + 5;

                bubble.style.top = top + '%';
                bubble.style.left = left + '%';
                bubble.classList.add(Math.random() > 0.5 ? 'left-in' : 'right-in');
                
                setTimeout(() => { danmakuContainer.appendChild(bubble); }, i * 1500 + 1000);
            });

            frames.forEach((frame, i) => { setTimeout(() => { frame.classList.add('show'); }, i * 1500 + 1000); });

            setTimeout(() => { 
                get('finalText').classList.add('show'); 
                const end = Date.now() + 8000; 
                (function frame() { confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0.1 }, colors:['#e0c3fc', '#ffecd2'] }); confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 0.9 }, colors:['#8ec5fc', '#c2e9fb'] }); if (Date.now() < end) requestAnimationFrame(frame); }()); 
            }, frames.length * 1500 + 1500); 
        }

        const canvas = document.getElementById('skyCanvas'); const ctx = canvas.getContext('2d'); let w, h; 
        function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; } window.addEventListener('resize', resize); resize();

        class Rain { constructor() { this.reset(); } reset() { this.x = Math.random()*w; this.y = Math.random()*-h; this.v = Math.random()*2+1; this.l = Math.random()*15+10; this.lineWidth = 1.5; this.opacity = Math.random()*0.5+0.3; } draw() { ctx.beginPath(); ctx.strokeStyle = `rgba(240, 248, 255, ${this.opacity})`; ctx.lineWidth = this.lineWidth; ctx.lineCap = 'round'; ctx.moveTo(this.x, this.y); ctx.lineTo(this.x, this.y+this.l); ctx.stroke(); } update() { this.y+=this.v; if(this.y>h) this.reset(); } }
        let rains = Array.from({ length: 300 }, () => new Rain());

        class Star { constructor() { this.reset(); } reset() { this.x = Math.random() * w; this.y = Math.random() * h; this.r = Math.random() * 1.5; this.opacity = Math.random()*0.8 + 0.2; } draw() { ctx.beginPath(); ctx.arc(this.x, this.y, this.r, 0, Math.PI*2); ctx.fillStyle = `rgba(255,255,255,${this.opacity})`; ctx.fill(); } }
        let stars = [];
        class Meteor { constructor() { this.reset(); } reset() { const spawnZone = w + h; const startPos = Math.random() * spawnZone; if (startPos < w) { this.x = startPos; this.y = -this.len || -100; } else { this.x = w + this.len || w + 100; this.y = startPos - w; } this.len = Math.random() * 300 + 200; this.speed = Math.random() * 18 + 12; this.size = Math.random() * 2 + 0.5; this.angle = Math.PI * 0.75 + (Math.random() * 0.2 - 0.1); this.opacity = 1; } draw() { const tailX = this.x + this.len * Math.cos(this.angle); const tailY = this.y - this.len * Math.sin(this.angle); const gradient = ctx.createLinearGradient(this.x, this.y, tailX, tailY); gradient.addColorStop(0, `rgba(255,255,255,${this.opacity})`); gradient.addColorStop(1, `rgba(255,255,255,0)`); ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(tailX, tailY); ctx.lineWidth = this.size; ctx.lineCap = 'round'; ctx.strokeStyle = gradient; ctx.stroke(); } update() { this.x -= this.speed * Math.cos(this.angle); this.y += this.speed * Math.sin(this.angle); this.opacity -= 0.015; if (this.y > h + 300 || this.opacity <= 0) { this.reset(); } } }
        let meteors = [];
        function initMeteors() { stars = Array.from({ length: 300 }, () => new Star()); meteors = Array.from({ length: 50 }, () => new Meteor()); }

        function animate() {
            ctx.clearRect(0, 0, w, h);
            if (animationMode === 'rain') { rains.forEach(r => { r.update(); r.draw(); }); } 
            else if (animationMode === 'meteor') { stars.forEach(s => s.draw()); meteors.forEach(m => { m.update(); m.draw(); }); }
            requestAnimationFrame(animate);
        }
        animate();
    </script>
</body>
</html>